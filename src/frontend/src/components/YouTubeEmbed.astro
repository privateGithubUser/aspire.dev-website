---
export interface Props {
  /** YouTube video or live stream ID (the ?v= value) */
  videoId: string;
  /** Accessible title for the iframe */
  title?: string;
  /** Aspect ratio — default 16/9 */
  aspectRatio?: string;
  /** Autoplay the stream (muted, as browsers require) */
  autoplay?: boolean;
  /** Max width constraint — default 100% */
  maxWidth?: string;
}

const {
  videoId,
  title = 'YouTube video player',
  aspectRatio = '16 / 9',
  autoplay = false,
  maxWidth = '100%',
} = Astro.props;

const params = new URLSearchParams({
  rel: '0',
  modestbranding: '1',
  playsinline: '1',
});
if (autoplay) {
  params.set('autoplay', '1');
  params.set('mute', '1');
}
const src = `https://www.youtube-nocookie.com/embed/${videoId}?${params.toString()}`;
---

<div class="yt-embed not-content" style={`--aspect-ratio: ${aspectRatio}; --max-width: ${maxWidth};`}>
  <iframe
    src={src}
    title={title}
    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
    referrerpolicy="strict-origin-when-cross-origin"
    allowfullscreen
    loading="lazy"
  ></iframe>
</div>

<style>
  .yt-embed {
    position: relative;
    width: 100%;
    max-width: var(--max-width, 100%);
    aspect-ratio: var(--aspect-ratio, 16 / 9);
    border-radius: 0.75rem;
    overflow: hidden;
    background: var(--sl-color-gray-6);
    border: 1px solid var(--sl-color-gray-5);
    box-shadow: var(--sl-shadow-sm);
  }

  .yt-embed iframe {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    border: 0;
  }
</style>
