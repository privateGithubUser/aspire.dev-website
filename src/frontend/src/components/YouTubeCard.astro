---
import { YouTube } from '@astro-community/astro-embed-youtube';
import { Badge } from '@astrojs/starlight/components';
import MediaCard from '@components/MediaCard.astro';

export interface Props {
  href: string;
  title: string;
  description?: string;
  tags: string[];
}
const { href, title, description, tags } = Astro.props;
---

<MediaCard>
  <YouTube slot="media" id={href} />
  <div class="meta sl-flex">
    <p class="title">{title}</p>
    {description && <p class="description" set:html={description} />}
    {
      tags && tags.length > 0 && (
        <div class="tags sl-flex" style={{ gap: '0.5rem' }}>
          {tags.map((tag) => (
            <Badge class="badge" text={tag} />
          ))}
        </div>
      )
    }
  </div>
</MediaCard>

<style>
  .meta {
    padding: 1rem;
    flex-direction: column;
    gap: 0.5rem;
  }
  .title {
    font-size: var(--sl-text-lg);
  }
  .description {
    color: var(--sl-color-gray-3);
    line-height: 1.5;
  }
</style>

<script is:inline>
  document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('lite-youtube').forEach((player) => {
      const videoId = player.getAttribute('videoid');
      
      const openYouTube = (event) => {
        event.preventDefault();
        event.stopImmediatePropagation();
        
        if (videoId) {
          window.open(`https://www.youtube.com/watch?v=${videoId}`, '_blank', 'noopener,noreferrer');
        }
      };
      
      const handleKeydown = (event) => {
        if (event.key === 'Enter' || event.key === ' ') {
          openYouTube(event);
        }
      };
      
      const playBtn = player.querySelector('.lyt-playbtn');
      if (playBtn) {
        playBtn.addEventListener('click', openYouTube, { capture: true });
        playBtn.addEventListener('keydown', handleKeydown, { capture: true });
      }
      
      // Also intercept clicks/keyboard on the player itself (thumbnail area)
      player.addEventListener('click', openYouTube, { capture: true });
      player.addEventListener('keydown', handleKeydown, { capture: true });
    });
  });
</script>
